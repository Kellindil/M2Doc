language: java
env:
  global:
  - DISPLAY=:99.0
  - MAVEN_OPTS="-XX:MaxPermSize=512m -Xmx2048m -Xms1024m"
jdk:
- oraclejdk7
sudo: false
install: true
before_script:
- export SWT_GTK3=0
- /sbin/start-stop-daemon --start --quiet --pidfile /tmp/custom_xvfb_99.pid --make-pidfile --background --exec /usr/bin/Xvfb -- :99 -ac -screen 0 1440x900x16
- sh -e /etc/init.d/xvfb start
- sleep 10
script:
- cd releng/org.obeonetwork.m2doc.parent/
- mvn -v
- mvn clean verify
- cd ../..
- if [[ "$TRAVIS_TAG" != "" ]]; then chmod a+x prepare-deploy-local-dir.sh && ./prepare-deploy-local-dir.sh $TRAVIS_BUILD_DIR/$TRAVIS_TAG; fi
after_script:
- if [[ "$TRAVIS_TAG" != "" ]]; then chmod a+x travis-promote.sh && ./travis-promote.sh; fi
before_deploy:
  - rvm 1.9.3 do gem install aws-sdk -v 2.2.37
deploy:
###### Release ######
- provider: s3
  access_key_id: AKIAJEQDFZXLAICP6TNQ
  secret_access_key:
   secure: MqoNagbJ5gBs/F+s50L0UF/ueZdGpQuTeITFtn8txlNUt5w1aa8AgnoZAL8eB/Ea7wlKMGckrBFDC6uHtPSsHtYGfs3BVD4ydsuXzP9H/WgS27c2L+z39C1M8vmBQtY8QsbQg1agFcg3JMbO4/esJfDI0NZYSU8+FeJv21CAcdswcgfSEAbr6G8x4ceuSxCHHgLosoaYo94kuL6Pt7fJ7AR1qMWut4AiUMuwwksJHV3ZJYyOAqve/lrzsn4A2CYjz1/WQIjZtsZDRKnUzqN+pV4xHUXBHGYUO/ekM1hRKCKBDisD6x2wYMlHRmJIfrknvdlSdXnW1sIq8rFlD54K8Yfns1ct5WBoN04nHNwjxxBl2dXPLZ0EMg5h+xc4p0T+rQyoov5QvhREybUEuaKqHaKhsuGA7UZzc1dh0Rdozp2goc3kGZSV/C+GwSAkPqvao5wY6+Ha9zj6FfJPnmps2T0UbMMmMg6PIhV7lJCzNSJJYHVGMyN7zsGal4xeFfF0TLE5mfbAhkNmt8x2qsV8issNu1zeTshE0r+MMWtEdAf4a9lTy1iSoRfWtsKibCCFPw/Uq+lwK5OJS7BLtmGQxV2/RvI8l4TMZYPHpyBGZHF/BZchVjpC+MdYMKzXnoRkFUpXcWEO2o3OCpFxu4E/B3z56yaMmw5jAXfsGZnmA9g=
  bucket: obeo-m2doc-releases
  local-dir: "${TRAVIS_BUILD_DIR}/${TRAVIS_TAG}"
  acl: public_read
  skip_cleanup: true
  region: eu-west-1
  upload-dir: ${TRAVIS_TAG}
  on:
    tags: true
    all_branches: true
    repo: ObeoNetwork/M2Doc

