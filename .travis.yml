language: java
env:
  global:
  - DISPLAY=:99.0
  - MAVEN_OPTS="-XX:MaxPermSize=512m -Xmx2048m -Xms1024m"  
jdk:
- oraclejdk7
sudo: false
install: true
before_script:
- export SWT_GTK3=0
- /sbin/start-stop-daemon --start --quiet --pidfile /tmp/custom_xvfb_99.pid --make-pidfile --background --exec /usr/bin/Xvfb -- :99 -ac -screen 0 1440x900x16
- sh -e /etc/init.d/xvfb start
- sleep 10
script:
- cd releng/org.obeonetwork.m2doc.parent/
- mvn -v
- mvn clean verify 
- cd ../..
- if [[ "$TRAVIS_TAG" != "" ]]; then chmod a+x prepare-deploy-local-dir.sh && ./prepare-deploy-local-dir.sh $TRAVIS_BUILD_DIR/$TRAVIS_TAG; fi
after_script:
- if [[ "$TRAVIS_TAG" != "" ]]; then chmod a+x travis-promote.sh && ./travis-promote.sh; fi
deploy:
###### Release ######
- provider: s3
  access_key_id: AKIAJEQDFZXLAICP6TNQ
  secret_access_key:
    secure: I9XLehZ8UpV6Z20n6ty1sfhWc4uTNIezEui7aq39wAo0sRflSwDVCeyCjYrnSg2H3Tm+/dvZ5YeuxRK8fAFBcYYbJttM8c1BrL5d0/PdQ7cN1xdhqwXDsVgvgiTWRaMteKVLzFxvE3JfpaSAIncW7Uegz6N2DnJ4klyQeidEeTnRL10RgdzjezN+6iN+3WpPvb90y+kELnJIajgYwW7F7rgmJ9FetNV2AbhyWC2XRaYnFJwblFmS3IQ5ObmLodijgotsinxWbfZg/xcTioutHXfPYBdG1jl8bFDBTr86RTKu1B5/CaaS8phUX6hBGzMRaB1QW1G1RdvCwusH0f8xEQ7KI2O+LkMfPgmRNb5pOf/92jC8vixxe6tz0XNMYSWOU/LgE6cLpuYffVDGA+xVhKZiRgxwxkI09ODWhG2ulLO0ZJU9jxdudRu6yju18ne7iJmwEHZy96TfXuK8z6UrVEPlAHA652NhPsXj+HJGWRMstWBhSInhlS8io7LnPkyQmMxG0rDQM0DgGUo8TNYlPyaqSWGeAvNM4QhgeOVN/Qn0alO/eU70vRFGHxPC7Hj0mh1BIp2hAfyYVSyfFpYovOW3ymtM529p4XJOuvFuvHFFXjM7CTtlI+VnGaS/8CrRK1DNToR9jrF14OhogZgXtOBe19TokzM7lCJ/0Xm4+nE=
  bucket: obeo-m2doc-releases
  local-dir: "${TRAVIS_BUILD_DIR}/${TRAVIS_TAG}"
  acl: public_read
  skip_cleanup: true
  region: eu-west-1
  upload-dir: ${TRAVIS_TAG}
  on:
    tags: true
    all_branches: true
    repo: ObeoNetwork/M2Doc

